<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>내 페이지 - 내가 쓴 글</title>
  <style>
    /* 스타일은 이전 코드와 동일 */
    body {
      background-color: #f9f9f9;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px;
      background-color: white;
      color: black;
    }

    .hamburger-menu {
      font-size: 24px;
      cursor: pointer;
    }

    .menu {
      display: none;
      position: absolute;
      right: 10px;
      top: 80px;
      background-color: white;
      border-radius: 5px;
      overflow: hidden;
    }

    .menu.active {
      display: block;
    }

    .menu ul {
      list-style: none;
      margin: 0;
      padding: 0;
    }

    .menu ul li {
      border-bottom: 1px solid #444;
    }

    .menu ul li a {
      display: block;
      padding: 10px 20px;
      color: black;
      text-decoration: none;
    }

    .menu ul li a:hover {
      background-color: #555;
      color: white;
    }

    #postsContainer {
      padding: 20px;
      background-color: #fff;
      border-radius: 5px;
      margin: 20px;
    }

    .post {
      border-bottom: 1px solid #ddd;
      padding: 10px;
    }

    .post-title {
      font-size: 18px;
      font-weight: bold;
    }

    .post-content {
      font-size: 16px;
      color: #555;
    }
  </style>
</head>
<body>
<header>
  <h2 onclick="reload()">커뮤니티</h2>
  <div class="hamburger-menu" onclick="toggleMenu()">☰</div>
</header>

<nav id="menu" class="menu">
  <ul>
    <li><a href="index.html" onclick="reload()">홈</a></li>
    <li><a href="userpage.html">내 페이지</a></li>
    <li><a href="del2.html">로그인</a></li>
    <li><a href="del.html">회원가입</a></li>
    <li><a onclick="logout()">로그아웃</a></li>
  </ul>
</nav>

<h2 style="margin-left: 20px;">내가 쓴 글</h2>
<div id="postsContainer"></div>
<script>
  function toggleMenu() {
    const menu = document.getElementById("menu");
    menu.classList.toggle("active");
  }

  function logout() {
    localStorage.removeItem("loggedInUser");
    window.location.href = "login.html";
  }

  function reload() {
    window.location.href = "index.html";
  }
</script>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import { getDatabase, ref, onValue, query, orderByChild, equalTo } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

  // Firebase 구성 정보를 JSON 파일에서 불러오기
  async function fetchFirebaseConfig() {
    const response = await fetch('./firebase-config.json'); // JSON 파일 경로
    const config = await response.json();
    return config;
  }

  // Firebase 초기화 및 데이터베이스 설정
  async function initializeFirebase() {
    const firebaseConfig = await fetchFirebaseConfig();
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    window.db = db; // 다른 함수에서도 접근할 수 있도록 설정
    fetchUserPosts(); // 사용자 게시글 가져오기
  }

  // 로그인된 사용자 정보 가져오기
  function getLoggedInUserId() {
    const loggedInUser = localStorage.getItem("loggedInUser");
    if (!loggedInUser) {
      console.error("로그인된 사용자가 없습니다.");
      return null;
    }
    const localPart = loggedInUser.split('@')[0];
    return localPart;
  }

  // 사용자 게시글 가져오기
  function fetchUserPosts() {
    const userId = getLoggedInUserId();
    if (!userId) return;

    const postsContainer = document.getElementById("postsContainer");
    const postsRef = ref(window.db, 'posts');
    const userPostsQuery = query(postsRef, orderByChild('userId'), equalTo(userId));

    onValue(userPostsQuery, (snapshot) => {
      postsContainer.innerHTML = ""; // 기존 게시물 초기화
      snapshot.forEach((childSnapshot) => {
        const post = childSnapshot.val();

        // HTML 요소 생성
        const postElement = document.createElement("div");
        postElement.classList.add("post");

        const titleElement = document.createElement("div");
        titleElement.classList.add("post-title");
        titleElement.innerText = post.title;

        const contentElement = document.createElement("div");
        contentElement.classList.add("post-content");
        contentElement.innerText = post.content;

        postElement.appendChild(titleElement);
        postElement.appendChild(contentElement);
        postsContainer.appendChild(postElement);
      });
    });
  }

  // 초기화
  initializeFirebase();
</script>

</body>
</html>
