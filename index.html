<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>짝퉁 디시</title>
    <link rel="stylesheet" href="testcss.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f9f9f9;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        h1 {
            text-align: center;
        }
        input, textarea {
            width: 100%;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            padding: 10px;
        }
        button {
            padding: 10px;
            font-size: 16px;
            background-color: #007BFF;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
            width: 100%;
        }
        button:hover {
            background-color: #0056b3;
        }
        .output {
            margin-top: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        .post {
            flex: 1 1 45%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: #f1f1f1;
            cursor: pointer;
            position: relative;
        }
        .post .author {
            font-weight: bold;
            font-size: 1.2em;
            color: #007BFF;
            margin-bottom: 5px;
        }
        .content {
            padding: 10px;
            background-color: #fff;
            border-radius: 4px;
            margin-top: 5px;
            white-space: pre-wrap;
            transition: max-height 0.3s ease;
        }
        .copy-button {
            margin-top: 10px;
            padding: 5px 10px;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            display: none;
        }
    </style>
</head>
<body>
<header>
    <h2 onclick="reload()">커뮤니티</h2>
    <div class="hamburger-menu" onclick="toggleMenu()">☰</div>
</header>

<nav id="menu" class="menu">
    <ul>
        <li><a href="index.html" onclick="reload()">홈</a></li>
        <li><a href="#">내 페이지</a></li>
        <li><a href="del2.html">로그인</a></li>
        <li><a href="del.html">회원가입</a></li>
        <li><a onclick="logout()">로그아웃</a></li>
    </ul>
</nav>

<main>
    <article>
        <p id="welcomeMessage"></p>
        <div class="container">
            <h1>글 공유 사이트</h1>
            <input type="text" id="userId" placeholder="아이디를 입력하세요..." disabled />
            <input type="text" id="titleInput" placeholder="제목을 입력하세요..." /><br><br>
            <textarea id="textInput" placeholder="여기에 글을 입력하세요..."></textarea><br>
            <button onclick="addPost()">글 공유하기</button>

            <h2>목록</h2>
            <div class="output" id="outputArea"></div>
        </div>
    </article>
</main>

<script>
    // 햄버거 메뉴 열기/닫기
    function toggleMenu() {
        const menu = document.getElementById("menu");
        menu.classList.toggle("active");
    }

    // 로그아웃 및 페이지 리로드
    function logout() {
        localStorage.removeItem("loggedInUser");
        window.location.href = "del2.html";
    }

    function reload() {
        window.location.href = "index.html";
    }

    document.addEventListener("DOMContentLoaded", () => {
        const loggedInUser = localStorage.getItem("loggedInUser");
        const welcomeMessage = document.getElementById("welcomeMessage");

        if (!loggedInUser) {
            alert("로그인이 필요합니다.");
            window.location.href = "del2.html";
        } else {
            const localPart = loggedInUser.split('@')[0];
            welcomeMessage.textContent = `${localPart}님, 환영합니다!`;
            document.getElementById("userId").value = localPart;
        }
    });
</script>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getDatabase, ref, push, onValue } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyBrCk-lqrYrwGfj1etOLYInGQkl7Mb_LOs",
        authDomain: "dukwebproject.firebaseapp.com",
        databaseURL: "https://dukwebproject-default-rtdb.firebaseio.com",
        projectId: "dukwebproject",
        storageBucket: "dukwebproject.firebasestorage.app",
        messagingSenderId: "278975563652",
        appId: "1:278975563652:web:23800b058e0980ef30ffd1",
        measurementId: "G-6HNE4ZDK9P"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    window.addPost = function addPost() {
        const userId = document.getElementById('userId').value;
        const titleInput = document.getElementById('titleInput').value;
        const textInput = document.getElementById('textInput').value;

        if (!userId || !titleInput || !textInput) {
            alert("모든 필드를 채워주세요!");
            return;
        }

        const postData = {
            userId,
            title: titleInput,
            content: textInput,
            timestamp: Date.now(),
        };

        const postsRef = ref(db, 'posts');
        push(postsRef, postData)
            .then(() => {
                alert("글이 성공적으로 저장되었습니다.");
                document.getElementById('titleInput').value = "";
                document.getElementById('textInput').value = "";
            })
            .catch(error => {
                alert("글 저장 실패: " + error.message);
            });
    };

    function fetchPosts() {
        const outputArea = document.getElementById('outputArea');
        const postsRef = ref(db, 'posts');

        onValue(postsRef, (snapshot) => {
            outputArea.innerHTML = ""; // 기존 글 초기화
            const posts = snapshot.val();
            const postArray = [];

            // 객체를 배열로 변환
            for (const key in posts) {
                postArray.push({ id: key, ...posts[key] });
            }

            // 최신 글이 위로 오도록 정렬 (timestamp 기준 내림차순)
            postArray.sort((a, b) => b.timestamp - a.timestamp);

            // 정렬된 글을 화면에 추가
            postArray.forEach(post => {
                const postDiv = document.createElement('div');
                postDiv.className = 'post';

                postDiv.innerHTML = `
                <p class="author">${post.userId}</p>
                <h3 class="title">${post.title}</h3>
                <div class="content">${post.content}</div>
                <button class="copy-button" onclick="copyToClipboard('${post.content}'); event.stopPropagation();">복사</button>
            `;

                outputArea.appendChild(postDiv);
            });
        });
    }


    document.addEventListener("DOMContentLoaded", fetchPosts);

    function copyToClipboard(text) {
        navigator.clipboard.writeText(text).then(() => {
            alert("글이 클립보드에 복사되었습니다.");
        }).catch(err => {
            alert("복사 실패: " + err.message);
        });
    }
</script>
</body>
</html>
